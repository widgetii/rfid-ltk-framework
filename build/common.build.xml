<?xml version="1.0" encoding="UTF-8"?>

<project
	xmlns:ivy="antlib:org.apache.ivy.ant"
	name="ru.aplix.ltk.build.common">

	<dirname file="${ant.file.ru.aplix.ltk.build.common}" property="build.dir"/>
	<property name="root.dir" location="${build.dir}/.."/>
	<property name="target.dir" location="${root.dir}/target"/>

	<property file="${build.dir}/ltk.release"/>
	<property file="build.properties"/>
	<property file="${build.dir}/ltk.properties"/>
	<property file="${build.dir}/ltk.default.properties"/>
	
	<property 
		name="jar.file"
		value="${target.dir}/${ant.project.name}-${ltk_version}.jar"/>

	<pathconvert property="source.path">
		<path>
			<filelist dir="." files="${source..}"/>
		</path>
		<regexpmapper from="${basedir}/(.*)$$" to="\1" handledirsep="true"/>
	</pathconvert>

	<ivy:settings file="${root.dir}/ivysettings.xml"/>
	
	<target
		name="compile"
		description="Compile the project">
		<mkdir dir="${output..}"/>
		<javac
			srcdir="${source.path}"
			destdir="${output..}"
			target="1.7"
			source="1.7"
			debug="${compile.debug}"
			debuglevel="${compile.debuglevel}"
			encoding="UTF-8"
			includeantruntime="false"
			taskname="${ant.project.name}">
			<classpath>
				<ivy:resources file="${ivy.file}"/>
			</classpath>
		</javac>
		<antcall target="copy-resources"/>
	</target>

	<extension-point name="copy-resources"/>

	<target
		name="package"
		depends="compile"
		description="Package the project JAR">
		<mkdir taskname="${ant.project.name}" dir="${target.dir}"/>
		<jar
			destfile="${jar.file}" 
			manifest="META-INF/MANIFEST.MF"
			encoding="UTF-8"
			taskname="${ant.project.name}">
			<fileset dir="${output..}"/>
		</jar>
	</target>

	<target name="test"/>

	<target name="clean" description="Cleans everything">
		<delete
				taskname="${ant.project.name}"
				includeemptydirs="true"
				dir="${output..}"/>
		<delete taskname="${ant.project.name}" file="${jar.file}"/>
	</target>

</project>
